<script>    $(document).ready(function(){        $('#name').on('keyup change',function(){            var name = $('#name').val();            $.post( url + "admin/product/generateLink", { name : name})                .done(function(data ) {                    $('#link').val(data);                    $('#full-link').val(url+'chi-tiet/'+data+'.html');                });        })        $('#link').keyup(function(){            var link = $('#link').val();            $('#full-link').val(url+'chi-tiet/'+link+'.html');        })        $(".img-product").click(function(){            var avatar = $(this).attr('id');            var id = $('#id-hidden').val();            $.post( url + "admin/product/avatar", { avatar : avatar , id : id })            $(".img-product").removeClass('avatar');            $(this).addClass('avatar')        })    })</script><style>    .avatar{        border : 1px solid #0000ff !important;    }    .attr-pad{        margin-bottom: 10px;    }	colorpicker-hidden{display: none;}    .colorpicker-visible{display: block!important;}    .select2-container .select2-selection--single{height: 34px!important;}    .select2-container--default .select2-selection--single .select2-selection__rendered{line-height: 34px!important;}        </style><input type="hidden" id="id-hidden" value="<?php echo (isset($info['id']))?$info['id']:"" ?>"><div class="portlet box blue">    <div class="portlet-title">        <div class="caption">            <i class="fa fa-reorder"></i><?php echo  (isset($info))?"Sửa ":"Thêm " ?>Sản Phẩm        </div>        <div class="tools">            <a href="javascript:;" class="collapse">            </a>            <a href="javascript:;" class="reload">            </a>        </div>    </div>    <div class="portlet-body form">        <!-- BEGIN FORM-->        <form action='<?php echo base_url()?>admin/product/<?php echo $action ?>/<?php echo  (isset($info['id']))?$info['id']:"" ?>' class="form-horizontal" method="post" enctype="multipart/form-data" id="a">            <div class="form-body">                <?php if(validation_errors()!=''){ ?>                    <div class="note note-danger" >                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button>                        <?php echo validation_errors() ?>                    </div>                <?php } ?>                <?php if(isset($error)&&$error=="upload"){                    echo "<div class='note note-danger'>";                    echo "<button type='button' class='close' data-dismiss='alert'>&times;</button>";                    echo "Upload ảnh chưa chính xác !!!";                    echo "   </div>";                } ?>                <div class="col-md-offset-2 col-md-10" style="margin-bottom: 20px ; margin-top: 20px">                    Ghi Chú : Những trường đánh dấu (*) là những trường bắt buộc .                </div>                <h3 class="form-section">Thông tin chung</h3>                <div class="form-group">					<label class="col-md-2 control-label">Danh Mục (*)</label>                    <div class="col-md-4">                        <select class="form-control" name="category">                            <?php $listcate = $this->mcategory->listAll(); foreach($listcate as $val){ ?>                            <option value="<?php echo $val['id'] ?>" <?php echo (isset($info) && $info['category'] == $val['id'] ? 'selected' : ''); ?>><?php echo $val['name'] ?></option>                            <?php } ?>                                </select>                    </div>                    				</div>                <div class="form-group">                    <label class="col-md-2 control-label">Tên Sản Phẩm (*)</label>                    <div class="col-md-4">                        <input type="text" id='name' required="required" name='name' placeholder="Tên Sản Phẩm ..." class='form-control' value='<?php                        echo (isset($info))?$info['name']:"" ?>' />                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Mã Sản Phẩm (*)</label>                    <div class="col-md-4">                        <input type="text" required="required" id='code' name='code' placeholder="Mã Sản Phẩm ..." class='form-control' value='<?php                        echo (isset($info))?$info['code']:"" ?>' />                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Đường Dẫn (*)</label>                    <div class="col-md-4">                        <input type="text" id='link' readonly="" required="required" name='link' placeholder="Đường Dẫn ..." class='form-control' value='<?php                        echo (isset($info))?$info['link']:"" ?>' />                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Info</label>                    <div class="col-md-6">                        <textarea name="info" style="width: 100%;" rows="5" ><?php echo (isset($info))?$info['info']:""?></textarea>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Key Word (*)</label>                    <div class="col-md-4">                        <input type="text" required="required" id='keyword' name='keyword' placeholder="Key Word ..." class='form-control' value='<?php                        echo (isset($info))?$info['keyword']:"" ?>' />                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Giá $ (*)</label>                    <div class="col-md-4">                        <input type="text" required="required" id='price' name='price' placeholder="Giá $ ..." class='form-control' value='<?php                        echo (isset($info))?$info['price']:"" ?>' />                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Description (*)</label>                    <div class="col-md-10">                        <textarea name="content" class="ckeditor"><?php echo (isset($info)) ? $info['content']:"" ?></textarea>                    </div>                </div>                <h3 class="form-section">Thuộc tính</h3>                <div class="listAttribute">                    <?php if(isset($info['id'])) { $listAttribute = $this->mattribute->getListMaterial($info['id']); foreach($listAttribute as $attribute){ ?>                    <div class="form-group">                        <label class="col-md-2 control-label">Chất Liệu (*)</label>                        <div class="col-md-10">                            <div class="row">                                <div class="col-md-7">                                    <div class="row">                                        <div class="col-md-6">                                            <input type="text" required="required" name='material0' value="<?php $material = json_decode($attribute['material'], true); echo $material[0]; ?>" placeholder="Chất Liệu ..." class='form-control materialAttribute' />                                            <input type="hidden" name="numSize0" value="1" class="numSize" />                                        </div>                                    </div>                                    <span class="help-block">            							 Vui lòng thêm 1 hoặc nhiều chất liệu sau đó thêm size và ảnh cho từng size            						</span>                                </div>                                <div class="col-md-5">                                    <a class="btn btn-primary addSize">Thêm Size</a>                                    <a class="btn btn-danger removeMaterial delMaterialInfo" data-product_id="<?php echo $info['id'] ?>" data-material="<?php echo $material[0]; ?>">Xóa Chất Liệu</a>                                </div>                            </div>                            <?php $listSize = $this->mattribute->getListSize($info['id'], $attribute['material']); foreach($listSize as $size){ ?>                            <div class="row" style="margin-bottom: 10px;">                                <div class="col-md-3">                                    <select class="form-control sizeAttribute" name='size0-1'>                                        <option value="XS" <?php echo (isset($size) && $size['size'] == 'XS' ? 'selected' : ''); ?>>XS</option>                                        <option value="S" <?php echo (isset($size) && $size['size'] == 'S' ? 'selected' : ''); ?>>S</option>                                        <option value="M" <?php echo (isset($size) && $size['size'] == 'M' ? 'selected' : ''); ?>>M</option>                                        <option value="L" <?php echo (isset($size) && $size['size'] == 'L' ? 'selected' : ''); ?>>L</option>                                        <option value="XL" <?php echo (isset($size) && $size['size'] == 'XL' ? 'selected' : ''); ?>>XL</option>                                        <option value="XXL" <?php echo (isset($size) && $size['size'] == 'XXL' ? 'selected' : ''); ?>>XXL</option>                                    </select>                                    <input type="hidden" name="idAttribute" value="<?php echo $size['id'] ?>" class="idAttribute" />                                </div>                                <div class="col-md-3">                                    <?php $imagesSize = json_decode($size['images'], true); if(count($imagesSize) > 0){ ?>                                    <img src="<?php echo base_url() ?>public/product/<?php echo $info['id'] ?>/<?php echo $size['id'] ?>/thumbnail/<?php echo $imagesSize[0] ?>" height="34px" />                                    <?php } ?>                                    <a class="btn btn-success" href="<?php echo base_url() ?>admin/product/attribute/<?php echo $info['id'] ?>/<?php echo $size['id'] ?>">Quản Lý Ảnh</a>                                </div>                                <div class="col-md-3 col-md-offset-1">                                    <a class="btn btn-danger removeSize delSizeInfo" data-product_id="<?php echo $info['id'] ?>" data-material="<?php echo $material[0]; ?>" data-size="<?php echo $size['size'] ?>">Xóa Size</a>                                </div>                            </div>                            <?php } ?>                        </div>                    </div>                    <?php } } else { ?>                    <div class="form-group">                        <label class="col-md-2 control-label">Chất Liệu (*)</label>                        <div class="col-md-10">                            <div class="row">                                <div class="col-md-10">                                    <div class="row">                                        <div class="col-md-6">                                            <input type="text" required="required" name='material0' placeholder="Chất Liệu ..." class='form-control materialAttribute' />                                            <input type="hidden" name="numSize0" value="1" class="numSize" />                                        </div>                                        <div class="col-md-3">                                            <input type="file" name="images0[]" title="Hình Ảnh (680 x 970)" class="form-control file-input imagesAttribute" data-filename-placement="inside" multiple="true" />                                        </div>                                    </div>                                </div>                            </div>                        </div>                    </div>                    <?php } ?>                </div>                <div class="form-group">                    <div class="col-md-offset-2 col-md-10">                        <a id="addMaterial" class="btn btn-warning">Thêm Chất Liệu</a>                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Bán Chạy </label>                    <div class="col-md-4">                        <input name="bestsell" value="1" type="checkbox" <?php echo (isset($info)&&$info['bestsell']==1)?"checked":"" ?> class="make-switch" />                    </div>                </div>                <div class="form-group">                    <label class="col-md-2 control-label">Nổi Bật </label>                    <div class="col-md-4">                        <input name="featured" value="1" type="checkbox" <?php echo (isset($info)&&$info['featured']==1)?"checked":"" ?> class="make-switch" />                    </div>                </div>                <h3 class="form-section">Thời gian</h3>                <div class="form-group">					<label class="control-label col-md-2">Ngày nhập</label>				       <div class="col-md-4">						<div class="input-group date form_meridian_datetime" data-date="<?php if(isset($info)) echo date("d-m-Y",$info['updated']); else echo date("d-m-Y",time()+6*3600); ?>">							<input type="text" size="16" readonly class="form-control" value="<?php if(isset($info)) echo date("d-m-Y",$info['updated']); else echo date("d-m-Y",time()+6*3600); ?>" name="date_update" />							<span class="input-group-btn">								<button class="btn default date-reset" type="button"><i class="fa fa-times"></i></button>							</span>							<span class="input-group-btn">								<button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>							</span>						</div>						<!-- /input-group -->					</div>				</div>                <div class="form-group">					<label class="control-label col-md-2">Giờ nhập</label>					<div class="col-md-3">						<div class="input-icon">							<i class="fa fa-clock-o"></i>							<input type="text" class="form-control timepicker timepicker-update" value="<?php if(isset($info)) echo date("H:i:s",$info['updated']); else echo date("H:i:s",time()+6*3600); ?>" name="time_update" />						</div>					</div>				</div>            </div>            <div class="form-actions nobg fluid">                <div class="col-md-offset-3 col-md-9">                    <a href="<?php if(isset($info) && isset($info['is_copy']) && $info['is_copy']=='true') echo base_url().'admin/product/del/'.$info['id']; else echo base_url().'admin/product/listall'; ?>"  class="btn default">Hủy bỏ</a>                    <button class="btn green" value="back" name='ok' type='submit'>Xác Nhận & Trở lại</button>                    <button class="btn green" id='btn-ok' name='ok' type='submit'>Xác Nhận</button>                </div>            </div>            <input type="hidden" name="numAttribute" id="numAttribute" value="1" />        </form>        <!-- END FORM-->    </div></div><div id="copyHTML" style="display: none;">     <div class="form-group">        <label class="col-md-2 control-label">Chất Liệu (*)</label>        <div class="col-md-10">            <div class="row">                <div class="col-md-10">                    <div class="row">                        <div class="col-md-6">                            <input type="text" required="required" name='material0' placeholder="Chất Liệu ..." class='form-control materialAttribute' />                            <input type="hidden" name="numSize" value="1" class="numSize" />                        </div>                        <div class="col-md-3">                            <input type="file" name="images1-1[]" title="Hình Ảnh (680 x 970)" class="form-control file-input imagesAttribute" data-filename-placement="inside" multiple="true" />                        </div>                    </div>                </div>                <div class="col-md-2">                    <a class="btn btn-danger removeMaterial">Xóa Chất Liệu</a>                </div>            </div>        </div>    </div></div><script>    function indexImage() {        var indexMaterial = 0;        $('.listAttribute .form-group').each(function(){            var indexSize = 0;            $(this).find('.materialAttribute').attr('name','material'+indexMaterial+'[]');            $(this).find('.imagesAttribute').attr('name','images'+indexMaterial+'[]');            $(this).find('.sizeAttribute').each(function(){              $(this).parent().find('.idAttribute').attr('name', 'idAttribute'+indexMaterial+'-'+indexSize);              indexSize++;              })            indexMaterial++;        })                $('#numAttribute').val($('.listAttribute .form-group').length);    }    $(document).ready(function(){        <?php if(isset($info['id'])) { ?>        indexImage();        <?php }?>        $('#addMaterial').click(function(){            var html = $('#copyHTML').html();            $('.listAttribute').append(html);            $(".listAttribute .select2Copy").select2({                 tags: true,                 placeholder: "Chất liệu"            });            $('.listAttribute .select2Copy').removeClass('select2Copy');            indexImage();        })        $('body').on('click', '.addSize', function(){            var html = $('#itemSize').html();            $(this).parent().parent().parent().append('<div class="row" style="margin-bottom: 10px;">' + html + '</div>');            indexImage();        })        $('body').on('click', '.removeSize', function(){            $(this).parent().parent().remove();            indexImage();        })        $('body').on('click','.removeMaterial', function(){            $(this).parent().parent().parent().parent().remove();            indexImage();        })        $(".delMaterialInfo").click(function(){            var material = $(this).data('material');            var product_id = $(this).data('product_id');            var parent = $(this).parent().parent().parent().parent();            bootbox.confirm("Bạn muốn xóa chất liệu này ?", function(result) {                if (result){                    $.post('<?php echo base_url() ?>admin/product/delMaterial',{material:material, product_id:product_id}, function(data){                        if (data === 'ok') {                            parent.remove();                        }                    })                }            });            return false;        });        $(".delSizeInfo").click(function(){            var material = $(this).data('material');            var size = $(this).data('size');            var product_id = $(this).data('product_id');            var parent = $(this).parent().parent();            bootbox.confirm("Bạn muốn xóa size của chất liệu này ?", function(result) {                if (result){                    $.post('<?php echo base_url() ?>admin/product/delSize', {material:material, product_id:product_id, size:size}, function(data){                        if (data === 'ok') {                            parent.remove();                        }                    })                }            });            return false;        });                        $('.timepicker-update').timepicker({            autoclose: true,            showSeconds: true,            minuteStep: 1,            showMeridian: false        });                $(".select2").select2({             tags: true,             placeholder: "Chất liệu"        });                $( "body" ).on( "mousemove", '.file-input-wrapper',function(cursor) {            var input, wrapper,                wrapperX, wrapperY,                inputWidth, inputHeight,                cursorX, cursorY;            // This wrapper element (the button surround this file input)            wrapper = $(this);            // The invisible file input element            input = wrapper.find("input");            // The left-most position of the wrapper            wrapperX = wrapper.offset().left;            // The top-most position of the wrapper            wrapperY = wrapper.offset().top;            // The with of the browsers input field            inputWidth= input.width();            // The height of the browsers input field            inputHeight= input.height();            //The position of the cursor in the wrapper            cursorX = cursor.pageX;            cursorY = cursor.pageY;            //The positions we are to move the invisible file input            // The 20 at the end is an arbitrary number of pixels that we can shift the input such that cursor is not pointing at the end of the Browse button but somewhere nearer the middle            moveInputX = cursorX - wrapperX - inputWidth + 20;            // Slides the invisible input Browse button to be positioned middle under the cursor            moveInputY = cursorY- wrapperY - (inputHeight/2);            // Apply the positioning styles to actually move the invisible file input            input.css({                left:moveInputX,                top:moveInputY            });			        });				$('body').bind("DOMNodeInserted DOMNodeRemoved", function(){			$('.bt-remove-color').unbind('click').bind('click',function(){				$(this).parent().parent().remove();			})		});    })    </script>